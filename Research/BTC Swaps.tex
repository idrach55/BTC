\documentclass[11pt]{report}
\renewcommand\thesection{\arabic{section}}
\renewcommand\thesubsection{\alph{subsection}}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{titlesec}
\usepackage{mathtools}
\usepackage{tikz}
\usetikzlibrary{automata,positioning}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}
\begin{document}

\begingroup  
    \centering
    \Large BTC Equity Swaps\\
    \large Isaac Drachman\par
\endgroup

\section*{Setup}
    There are two agents: the platform (denoted P), and the client (denoted C.) The client
    enters into a swap with the platform by which each day the client is paid daily returns off an ETF
    if the returns are positive, and the client pays daily returns if the returns are negative. 
    Regardless of it the ETF rose or fell, the client pays a funding rate. All returns and the 
    funding rate are applied to a constant Bitcoin notional and exchanged in Bitcoin.
   
\section*{Notation}
    Let $S_t$ be the daily closing price of the underlying ETF. Let $X_t$ be the daily
    closing exchange rate for BTC/USD (i.e. BTC is base currency.) Let $N$ be the constant BTC 
    notional value of the swap. And let $f$ be the funding rate (fee.) We then say the daily
    percent returns on the underlying are
    \[
    R_t = \frac{S_t - S_{t-1}}{S_{t-1}}
    \]
    The matrix of daily cashflows in Bitcoin between P and C is
    \[
    \begin{tabular}{c|c|c}
    & P pays C daily & C pays P daily \\
    \hline
    if $R_t \geq 0$ & $NR_t$ & $Nf$ \\
    \hline
    if $R_t < 0$ & 0 & $N(f - R_t)$
    \end{tabular}
    \]
    Each of these can be multiplied by $X_t$ to get the daily cashflows in USD.
    
\section*{Valuation and Hedging}
    We consider everything from the platform's point-of-view. P will be valuing
    and hedging the swap, aspects that we claim C is not concerned with. We also say
    that P uses USD as their accounting currency. The total cashflow in USD from
    the P's perspective is
    \[
    V_P = \sum_{t=1}^T NX_t(f - R_t) 
    \]
    Note that this is when P is fully unhedged. There are two hedges that the platform
    makes, one for the underlying risk (spot delta), and one for the currency risk (fx delta.) 
    For spot delta, P should hold $n_t$ shares of the underlying upon the close of day $t$. 
    We define
    \[
    n_t = \frac{NX_t}{S_t}
    \]
    The hedging prescription is for P to buy 
    $n_t - n_{t-1} = N\left(\frac{X_t}{S_t}-\frac{X_{t-1}}{S_{t-1}}\right)$ shares of the underlying
    ETF at its closing price. The daily hedge PnL is
    \[
    n_{t-1}(S_t - S_{t-1}) = NX_{t-1}R_t
    \]
    Note that a day's return on the underlying is applied to the shares prescribed by yesterday's closing
    price. This is a mark-to-market PnL. The actual daily cashflows induced by the hedge are
    $(n_{t-1}-n_t)S_t$, i.e. either cash is spent by accumulating shares, or is generated by selling excess
    shares. We consider the mark-to-market valuation, which yields
    \begin{align*}
    V_P &= \sum_{t=1}^T NX_t(f - R_t) + n_{t-1}(S_t - S_{t-1}) \\
    &= N\sum_{t=1}^T fX_t + R_t(X_{t-1} - X_t) \\
    &= N\sum_{t=1}^T fX_t - R_t\Delta X_t
    \end{align*}
    By hedging against spot delta, we've changed our exposure to $R_t$ from being proportional
    to the exchange rate to being proportional to the daily change in the exchange rate. This leaves
    us with fx delta. Note that when $R_t > f$, P is short bitcoin, and when $R_t < f$, P is long bitcoin.
    \\\\
    We look to set $f$ such that it sufficiently covers averse moves due to the cross risk. This can be most
    aptly performed by using a Monte-Carlo simulation to value the swap for a given funding rate. By revaluing
    for different levels of $f$, we can solve for the fee that produces a specified expected return. Please
    see the accompanying python code \texttt{swaps.py} which implements the MC valuation. 
    

\end{document}